[3:44 p.m., 28/7/2025] Cobro: <!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Perfil - GPT Oficial</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="overlay">
    <div class="container">
      <header class="header">
        <img src="imagen/logo.png" alt="Logo" class="logo" />
        <h1>Mi perfil</h1>
        <p class="tagline">Aqu√≠ puedes gestionar tu cuenta, recargas y paquetes</p>
      </header>

      <section class="perfil-info">
        <p><strong>Nombre:</strong> <span id="user-nombre">Cargando...</span></p>
        <p><strong>Tel√©fono:‚Ä¶
[3:46 p.m., 28/7/2025] Cobro: <!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Perfil - GPT Oficial</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="overlay">
    <div class="container">
      <header class="header">
        <img src="imagen/logo.png" alt="Logo" class="logo" />
        <h1>Mi perfil</h1>
        <p class="tagline">Aqu√≠ puedes gestionar tu cuenta, recargas y paquetes</p>
      </header>

      <section class="perfil-info">
        <p><strong>Nombre:</strong> <span id="user-nombre">Cargando...</span></p>
        <p><strong>Tel√©fono:</strong> <span id="user-phone">Cargando...</span></p>
        <p><strong>Saldo disponible:</strong> $<span id="user-saldo">0</span></p>
        <p><strong>Referido por:</strong> <span id="user-referido">-</span></p>
      </section>

      <section class="qr-section">
        <h2>Recarga a trav√©s de Nequi</h2>
        <img src="imagen/nequi_qr.png" alt="QR Nequi" class="qr-image" />
        <p>N√∫mero: 300 000 0000 (Ejemplo)</p>
      </section>

      <section class="recarga-section">
        <h2>Recargar saldo</h2>
        <p>Realiza el pago a Nequi y sube el comprobante.</p>
        <form id="form-recarga" class="formulario">
          <input type="number" id="monto-recarga" placeholder="Monto a recargar" required />
          <input type="text" id="referencia-recarga" placeholder="Referencia o n√∫mero de comprobante" required />
          <button type="submit">Enviar recarga</button>
        </form>
        <p class="nota-info">Las recargas se validan en un m√°ximo de 24 horas.</p>
      </section>

      <section class="acciones-perfil">
        <button onclick="window.location.href='paquetes.html'">Ver paquetes</button>
        <button onclick="window.location.href='retiro.html'">Solicitar retiro</button>
        <button onclick="cerrarSesion()">Cerrar sesi√≥n</button>
      </section>

      <section class="historial-recargas">
        <h2>üì• Historial de Recargas</h2>
        <ul id="lista-recargas" class="historial-lista"></ul>
      </section>

      <section class="historial-retiros">
        <h2>üì§ Historial de Retiros</h2>
        <ul id="lista-retiros" class="historial-lista"></ul>
      </section>
    </div>
  </div>

  <!-- Firebase + l√≥gica -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import {
      getFirestore,
      doc,
      getDoc,
      collection,
      addDoc,
      getDocs,
      query,
      where
    } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDlZpLwWrawJcRYklBTNBUyrjQlcydhd8Q",
      authDomain: "gpt-oficial.firebaseapp.com",
      projectId: "gpt-oficial",
      storageBucket: "gpt-oficial.appspot.com",
      messagingSenderId: "569754799193",
      appId: "1:569754799193:web:ba799e21890b58254d7548",
      measurementId: "G-HV4YYL4VC0"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const nombre = localStorage.getItem("nombre");
    const telefono = localStorage.getItem("telefono");

    document.getElementById("user-nombre").textContent = nombre || "Desconocido";
    document.getElementById("user-phone").textContent = telefono || "Desconocido";

    async function obtenerDatosUsuario() {
      if (!telefono) return;

      try {
        const docRef = doc(db, "usuarios", telefono);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
          const data = docSnap.data();
          document.getElementById("user-saldo").textContent = data.saldo?.toFixed(2) || "0";
          document.getElementById("user-referido").textContent = data.referido || "No registrado";
        } else {
          document.getElementById("user-saldo").textContent = "0";
          document.getElementById("user-referido").textContent = "No registrado";
        }
      } catch (error) {
        console.error("Error al obtener datos:", error);
        document.getElementById("user-saldo").textContent = "Error";
        document.getElementById("user-referido").textContent = "Error";
      }
    }

    obtenerDatosUsuario();

    // Recarga
    const formRecarga = document.getElementById("form-recarga");
    if (formRecarga) {
      formRecarga.addEventListener("submit", async (e) => {
        e.preventDefault();
        const monto = parseFloat(document.getElementById("monto-recarga").value);
        const referencia = document.getElementById("referencia-recarga").value.trim();

        if (!monto || !referencia || !telefono) {
          alert("Completa todos los campos");
          return;
        }

        try {
          await addDoc(collection(db, "recargas"), {
            telefono,
            nombre,
            monto,
            referencia,
            estado: "pendiente",
            fecha: new Date().toISOString()
          });

          alert("Recarga enviada correctamente. Espera validaci√≥n.");
          formRecarga.reset();
        } catch (e) {
          console.error("Error al enviar recarga:", e);
          alert("Ocurri√≥ un error. Int√©ntalo m√°s tarde.");
        }
      });
    }

    // Historial de recargas
    async function cargarHistorialRecargas() {
      try {
        const q = query(collection(db, "recargas"), where("telefono", "==", telefono));
        const snapshot = await getDocs(q);
        const lista = document.getElementById("lista-recargas");
        lista.innerHTML = "";

        snapshot.forEach((docu) => {
          const data = docu.data();
          const li = document.createElement("li");
          li.textContent = `üí∞ $${data.monto} - ${data.estado} - ${new Date(data.fecha).toLocaleDateString()}`;
          lista.appendChild(li);
        });
      } catch (e) {
        console.error("Error historial recargas:", e);
      }
    }

    // Historial de retiros
    async function cargarHistorialRetiros() {
      try {
        const q = query(collection(db, "retiros"), where("telefono", "==", telefono));
        const snapshot = await getDocs(q);
        const lista = document.getElementById("lista-retiros");
        lista.innerHTML = "";

        snapshot.forEach((docu) => {
          const data = docu.data();
          const li = document.createElement("li");
          li.textContent = `üí∏ $${data.monto} - ${data.estado} - ${new Date(data.fecha).toLocaleDateString()}`;
          lista.appendChild(li);
        });
      } catch (e) {
        console.error("Error historial retiros:", e);
      }
    }

    cargarHistorialRecargas();
    cargarHistorialRetiros();

    // Cerrar sesi√≥n
    function cerrarSesion() {
      localStorage.clear();
      window.location.href = "index.html";
    }
    window.cerrarSesion = cerrarSesion;
  </script>
</body>
</html>